<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nyan Collision Test</title>
    <style>
      * { box-sizing: border-box; }
      html, body { width: 100%; height: 100%; margin: 0; }
      body { overflow: hidden; background: #22497b; }
      .stage { position: relative; width: 100%; height: 100vh; }

      .sparkle-field {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
      }

      .sparkle-frame6 { animation: sparkle 0.42s linear 0.35s infinite; }
      .sparkle-frame5 { animation: sparkle 0.42s linear 0.28s infinite; }
      .sparkle-frame4 { animation: sparkle 0.42s linear 0.21s infinite; }
      .sparkle-frame3 { animation: sparkle 0.42s linear 0.14s infinite; }
      .sparkle-frame2 { animation: sparkle 0.42s linear 0.07s infinite; }
      .sparkle-frame1 { animation: sparkle 0.42s linear 0s infinite; }
      @keyframes sparkle {
        0%,16.666666% { opacity: 1; }
        16.6666666%,100% { opacity: 0; }
      }

      .cat-entity {
        position: absolute;
        width: 320px;
        height: 84px;
        will-change: transform;
      }

      .layer {
        position: absolute;
        top: 0;
        left: 0;
        display: block;
        width: 100%;
        height: auto;
      }

      .trail-1 { transform: translateX(-180px); opacity: 0.22; }
      .trail-2 { transform: translateX(-120px); opacity: 0.4; }
      .trail-3 { transform: translateX(-65px); opacity: 0.62; }
      .sprite { z-index: 5; }
    </style>
  </head>
  <body>
    <main class="stage" aria-label="Collision test: Nyan Cat bounces diagonally on screen edges">
      <svg class="sparkle-field" viewBox="0 0 320 180" preserveAspectRatio="none" aria-hidden="true">
        <defs>
          <g id="sparkle" transform="scale(0.9)" stroke="#d9f0ff">
            <path class="sparkle-frame1" d="M3.5 0 v2 M7 3.5 h-2 M3.5 7 v-2 M0 3.5 h2 M3 3.5 h1" />
            <path class="sparkle-frame2" d="M3 0.5 h1 M5 1.5 h1 M6 3.5 h1 M5 5.5 h1 M3 6.5 h1 M1 5.5 h1 M0 3.5 h1 M1 1.5 h1" />
            <path class="sparkle-frame3" d="M3 0.5 h1 M6 3.5 h1 M3 6.5 h1 M0 3.5 h1" />
            <path class="sparkle-frame4" d="M3 3.5 h1" />
            <path class="sparkle-frame5" d="M3 2.5 h1 M4 3.5 h1 M3 4.5 h1 M2 3.5 h1" />
            <path class="sparkle-frame6" d="M3.5 1 v2 M4 3.5 h2 M3.5 4 v2 M1 3.5 h2" />
          </g>
        </defs>
        <use href="#sparkle"><animateMotion dur="0.77s" repeatCount="indefinite" path="M250 10 70 10" /></use>
        <use href="#sparkle"><animateMotion begin="0.2566s" dur="0.77s" repeatCount="indefinite" path="M255 23 65 23" /></use>
        <use href="#sparkle"><animateMotion begin="0.5133s" dur="0.77s" repeatCount="indefinite" path="M260 36 60 36" /></use>
        <use href="#sparkle"><animateMotion begin="0.1283s" dur="0.77s" repeatCount="indefinite" path="M260 130 60 130" /></use>
        <use href="#sparkle"><animateMotion begin="0.385s" dur="0.77s" repeatCount="indefinite" path="M255 143 65 143" /></use>
        <use href="#sparkle"><animateMotion begin="0.6416s" dur="0.77s" repeatCount="indefinite" path="M250 166 70 166" /></use>
      </svg>

      <div id="cat" class="cat-entity">
        <img class="layer trail-1" src="nyan-trail.svg" alt="" aria-hidden="true" />
        <img class="layer trail-2" src="nyan-trail.svg" alt="" aria-hidden="true" />
        <img class="layer trail-3" src="nyan-trail.svg" alt="" aria-hidden="true" />
        <img class="layer sprite" src="nyan-sprite.svg" alt="Animated Nyan Cat collision test" />
      </div>
    </main>

    <script>
      const cat = document.getElementById('cat');
      const size = { w: 320, h: 84 };
      const state = { x: 180, y: 120, vx: 3.6, vy: 2.4 };

      function tick() {
        const maxX = window.innerWidth - size.w;
        const maxY = window.innerHeight - size.h;

        state.x += state.vx;
        state.y += state.vy;

        if (state.x <= 0) {
          state.x = 0;
          state.vx = Math.abs(state.vx);
        } else if (state.x >= maxX) {
          state.x = maxX;
          state.vx = -Math.abs(state.vx);
        }

        if (state.y <= 0) {
          state.y = 0;
          state.vy = Math.abs(state.vy);
        } else if (state.y >= maxY) {
          state.y = maxY;
          state.vy = -Math.abs(state.vy);
        }

        const facing = state.vx >= 0 ? 1 : -1;
        cat.style.transform = `translate(${state.x}px, ${state.y}px) scaleX(${facing})`;
        requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
    </script>
  </body>
</html>
